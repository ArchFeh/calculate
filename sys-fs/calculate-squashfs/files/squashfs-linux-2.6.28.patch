--- linux-2.6.28.orig/fs/squashfs/inode.c	2009-04-14 10:41:25.000000000 +0400
+++ linux-2.6.28/fs/squashfs/inode.c	2009-04-14 10:42:48.000000000 +0400
@@ -693,11 +693,7 @@
 		goto failure;
 	}
 
-	dentry = d_alloc_anon(i);
-	if (dentry == NULL) {
-		iput(i);
-		dentry = ERR_PTR(-ENOMEM);
-	}
+	dentry = d_obtain_alias(i);
 
 failure:
 	return dentry;
