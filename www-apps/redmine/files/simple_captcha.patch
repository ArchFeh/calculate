--- app/controllers/application_controller.rb
+++ app/controllers/application_controller.rb
@@ -19,6 +19,7 @@ require 'uri'
 require 'cgi'
 
 class ApplicationController < ActionController::Base
+  include SimpleCaptcha::ControllerHelpers
   include Redmine::I18n
 
   layout 'base'
--- config/routes.rb
+++ config/routes.rb
@@ -269,4 +269,6 @@ ActionController::Routing::Routes.draw do |map|
   map.connect 'robots.txt', :controller => 'welcome', :action => 'robots'
   # Used for OpenID
   map.root :controller => 'account', :action => 'login'
+  # Captcha
+  map.simple_captcha '/simple_captcha/:action', :controller => 'simple_captcha'
 end
--- vendor/plugins/simple_captcha/lib/simple_captcha_config.rb
+++ vendor/plugins/simple_captcha/lib/simple_captcha_config.rb
@@ -12,7 +12,7 @@ module SimpleCaptcha #:nodoc
     end
     
     def simple_captcha_key #:nodoc
-      session[:simple_captcha] ||= Digest::SHA1.hexdigest(Time.now.to_s + session.session_id.to_s)
+      session[:simple_captcha] ||= Digest::SHA1.hexdigest(Time.now.to_s)
     end
         
     def simple_captcha_value(key = simple_captcha_key) #:nodoc
--- app/controllers/account_controller.rb
+++ app/controllers/account_controller.rb
@@ -92,7 +92,9 @@ class AccountController < ApplicationController
       @user = User.new(params[:user])
       @user.admin = false
       @user.status = User::STATUS_REGISTERED
-      if session[:auth_source_registration]
+      if !simple_captcha_valid?
+        flash.now[:error] = l(:notice_account_invalid_captcha)
+      elsif session[:auth_source_registration]
         @user.status = User::STATUS_ACTIVE
         @user.login = session[:auth_source_registration][:login]
         @user.auth_source_id = session[:auth_source_registration][:auth_source_id]
--- app/views/account/register.rhtml
+++ app/views/account/register.rhtml
@@ -37,6 +37,9 @@
 <% @user.custom_field_values.select {|v| v.editable? || v.required?}.each do |value| %>
        <p><%= custom_field_tag_with_label :user, value %></p>
 <% end %>
+
+<p><span><label for="captcha"><%=l(:field_captcha_valid)%> <span class="required">*</span></label>
+<%= show_simple_captcha(:label => '') %></span></p>
 <!--[eoform:user]-->
 </div>
 
